{% extends "layout.html" %}
{% block files %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{{ url_for('static',filename='sep_post.css')}}">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/all.min.css')}}">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/fontawesome.min.css')}}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>



    <link rel="stylesheet" href="{{ url_for('static',filename = 'MDB/css/bootstrap.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename = 'MDB/css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename = 'MDB/css/mdb.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename = 'MDB/css/mdb.lite.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename = 'MDB/css/mdb.lite.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename = 'MDB/css/mdb.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename = 'MDB/css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename = 'MDB/css/modules/animations-extended.min.css') }}">
{% endblock files %}
{% block content %}

    <div class="__container">
        {% with messages = get_flashed_messages(with_categories = true) %}
            {% if messages %}
                {% for category,message in messages%}
                    <div>
                        {% if category == "info" %}
                            <div class = "alert alert-info" ><i class="fas fa-bell fl-fw icon_bell"></i>{{ message }}</div>
                        {% elif category == "success" %}
                            <div class = "alert alert-success" ><i class="fas fa-check-circle fl-fw icon_tick"></i>{{ message }}</div>
                        {% elif category == "danger" %}
                            <div class = "alert alert-danger" ><i class="fas fa-times-circle fl-fw icon_danger"></i>{{ message }}</div>
                        {% endif %}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        <div class="sub-container">
            <div class="headerr">
                <div class="menuu">
                    {% if current_user.is_authenticated: %}
                        <header class="header" style="background: rgba(0,0,0,0.8);">
                            <a href="{{ url_for('users.account') }}" class="logo"><div class="hello"><img src = "{{ url_for('static',filename = 'images/' + current_user.profile_pic) }}" alt = "{{ username_menu }}" class = "profile-pic"><div style="display: block;"><p class="user1">{{ username_menu }}</p><br><p class="user1" style="font-size: 9px; margin-top: -60px; color: white;">{{ present_time.strftime('%H hr  %M min  %S sec') }}</p><p class="user1" style="font-size: 9px; margin-top: -10px; color: white;">{{ present_time.strftime('%a %B %Y') }}</p></div></div></a>
                            <input class="menu-btn" type="checkbox" id="menu-btn" />
                            <label class="menu-icon" for="menu-btn"><span class="navicon"></span></label>
                            <ul class="menu" style="margin-left: -10px; margin-top: 20px; background: rgba(0,0,0,0.4);">
                                <li class="account_btn" style="padding-left: 10px;"><a href="{{url_for('users.account')}}" style="color: #FA0509;">Account</a></li>
                                <li class="ask_btn" style="padding-left: 10px;"><a href="{{url_for('posts.create_post')}}" style="color: #FA0509;">Ask</a></li>
                                <li class="logout_btn" style="padding-left: 10px;"><a href="{{url_for('users.logout')}}" style="color: #FA0509;">Logout</a></li>
                            </ul>
                        </header>
                    {% else %}
                        <header class="header" style="background: rgba(0,0,0,0.8);">
                            <a href="{{ url_for('users.login') }}" class="logo"><div class="hello"><img src = "{{ profile_pic }}" alt = "{{ username_menu }}" class = "profile-pic"><p class="user1">{{ username_menu }}</p></div></a>
                            <input class="menu-btn" type="checkbox" id="menu-btn" />
                            <label class="menu-icon" for="menu-btn"><span class="navicon"></span></label>
                            <ul class="menu" style="margin-left: -10px; margin-top: 20px; background: rgba(0,0,0,0.4);">
                                <li class="login_btn" style="padding-left: 10px;"><a href="{{url_for('users.login')}}" style="color: #FA0509;">Login</a></li>
                                <li class="register_btn" style="padding-left: 10px;"><a href="{{url_for('users.register')}}" style="color: #FA0509;">Register</a></li>
                            </ul>
                        </header>
                    {% endif %}
                </div>
            </div>
            <div class="question-box">
                <div class="questions">
                            <div class = "post">
                                <div class="question">
                                    <div class="post_info">
                                        <div class = "post_pic"><img src="{{url_for('static',filename = 'images/'+post.author.profile_pic)}}" alt = "{{ post.author.profile_pic }}" class = "profile-pic-1"></div>
                                        <div class="user_post_info">
                                            <a href="{{url_for('users.all_user_post', username = post.author.username)}}"><p class="post_author">{{ post.author.username[:13] }}</p></a>
                                            <div class="" style="margin-top: 5px; display: flex;"><p class="post_date mr-2" style="font-size: 8px;">{{ post.date_posted.strftime('%d-%m-%Y') }}</p>
                                            <p class="post_time" style="font-size: 8px;">{{ post.date_posted.strftime('%H:%M:%S') }}</p></div>
                                            <div style="display: flex;">
                                                <p class="mr-2 pr-2 pl-2" style="border-radius: 2px; background: white; color: rgba(0,0,0,0.6); font-size: 11px;">{{ no_of_likes }} <i class="far fa-thumbs-up"></i></p>
                                                <p class="mr-2 pr-2 pl-2" style="height: 16px; border-radius: 2px; background: white; color: rgba(0,0,0,0.6); font-size: 11px;">{{ _comments|length }} <i class="far fa-comment"></i></p>
                                            </div>
                                            
                                            <form action="{{ url_for('posts.update_post', post_id = post.id) }}" method="POST">
                                            <div style="display: block;" class="mt-2 ml-n3">
                                                
                                                    
                                                    
                                                    
                                                <div style="display: flex;">
                                                        {% if post_like_name == "like" %}
                                                            <a class="btn btn-primary btn-sm text-center pt-1.5 mr-3" style="padding: 6px; height: 25px; width: 27px; font-size: 0px;border-radius: 50%;"  href="{{url_for('posts.like',post_id = post.id)}}"><i class="fas fa-thumbs-up" style="color: white; font-size: 13px; margin-top: -1px;"></i></a>
                                                        {% elif post_like_name == "unlike" %}
                                                            <a class="btn btn-danger btn-sm text-center pt-2 mr-3" style="padding: 6px; height: 25px; width: 27px; font-size: 0px;border-radius: 50%;"  href="{{url_for('posts.like',post_id = post.id)}}"><i class="fas fa-thumbs-down" style="background: ; color: white; font-size: 13px; margin-top: -1px;"></i></a>
                                                        {% endif %}
                                                    
                                                    
                                                    
                                                
                                                
                                                
                                                    <div class="dropdown">
                                                        
                                                        <button class="waves-effect light-effect dropdown-toggle" style="padding: 2px; padding-left: 4px; padding-right: 3px; border-radius: 2px; border: 1px solid transparent; font-size: 11px; background: rgb(66,133,244);" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">OPTIONS</button>
                                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                            
                                                            <button type="button" class="btn btn-primary btn-sm" style="width: 93%;"  data-toggle="modal" data-target="#exampleModal">
                                                                View Comments
                                                            </button>
                                                            <button type="button" class="btn btn-primary btn-sm" style="width: 93%;"  data-toggle="modal" data-target="#exampleModalCenter">
                                                                Comment
                                                            </button>
                                                            {% if post.author.username == current_user.username %}
                                                                <button type="button"  class="btn btn-danger btn-sm" style="width: 93%;" data-toggle="modal" data-target="#DELETE">
                                                                    Delete
                                                                </button>
                                                            {% endif %}
                                                            {% if post.author.username == current_user.username %}
                                                                <button type="submit" class="btn btn-primary btn-sm" style="width: 93%;" >Edit it</button></form>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                    
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="whole_post_content">
                                        <a href="{{url_for('posts.post',post_id = post.id)}}"><p class="post_title">{{ post.title }}</p></a>
                                        <p class="post_content">{{ post.content }}</p>
                                    </div>
                                    
                                </div>
                            </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="DELETE" tabindex="-1" role="dialog" aria-labelledby="DELETELabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="DELETELabel" style="color: tomato;">WARNING</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              Do you want to delete this post?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <form action="{{ url_for('posts.delete_post',post_id = post.id) }}" method="POST">
                    <button type="submit" class="btn btn-primary">Delete</button>
                </form>
            </div>
          </div>
        </div>
      </div>
    



            

    
        
      
    


        
    
    
    <!-- Modal -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Comment</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
                
                <div class = "form-group">
                    <form action = "" method = "POST">
                      {{ form.hidden_tag() }}
                        <fieldset class = "">
                        
                          
                                                    
                            <div class="form-group">
                                {{ form.commentor(class = "form-control",placeholder = "Username") }}
                                {% if form.commentor.errors %}
                                    {% for error in form.commentor.errors%}
                                        <small class="form-text text-danger">{{ error }}</small>
                                    {% endfor %}
                                {% endif %}
                            
                            </div>
                        
                          
                            
                            <div class="form-group purple-border">
                                
                                {{ form.comment(class="form-control", id="exampleFormControlTextarea4", rows="3",placeholder = "Type you comment/answer here...") }}
                                {% if form.comment.errors %}
                                  {% for error in form.comment.errors%}
                                  <small class="form-text text-danger">{{ error }}</small>
                                  {% endfor %}
                                {% endif %}
                            </div>
                            
                           
                          
                        </fieldset>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btnlight" data-dismiss="modal">Close</button>
                            <div class = "submit_btn">
                                {{ form.submit(class = "btn btn-primary") }}
                              </div>
                        </div>
                    </form>
                  </div>
                  

            </div>
            
        </div>
        </div>
    </div>

    

        





    <div class="modal left fade" id="exampleModal" tabindex="" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="background: transparent;">
                
                <div class="modal-body">
                    <div class="nav flex-sm-column flex-row">
                                   <!--Grid row-->
                        <div class="row">
                        
                            <!--Grid column-->
                            <div class="col-md-15 mb-4 mr-2">
                                <div class="text-center">
                                    <button class="">Comments</button>
                                </div>
                                
                                {% for comment in _comments %}
                                    <div class="card mb-4 ml-2" style="width: 335px;">
                                        <div class="card-header">
                                            Commented by {{comment.commentor}}
                                        </div>
                                        <div class="card-body">
                                        <img src="{{ url_for('static',filename = 'images/'+comment.profile_pic) }}" class="rounded float-left" style="height: 70px; width: 70px;">
                                        <div class="float-right mt-n1">
                                            <h5 class="card-title">{{comment.commentor}}</h5>
                                            <p class="card-text " style="font-size: 10px;">{{comment.timestamp.strftime('%a %d %B %Y')}}</p>
                                            <p class="card-text mt-n2" style="font-size: 10px;">{{comment.timestamp.strftime('%H:%M:%S')}}</p>
                                        </div>
                                        
                                        </div>
                                        <div class="card-body float-bottom">
                                            <p class="card-text text-muted">{{comment.comment}}</p>
                                        </div>
                                    </div>
                                {% endfor %}
                        
                            </div>
                        </div>
                    </div>
                </div>
                <div class="fixed-bottom text-center">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>







    <!-- jQuery -->
  <script type="text/javascript" src="{{ url_for('static',filename='MDB/js/jquery.min.js')}}"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="{{ url_for('static',filename='MDB/js/popper.min.js')}}"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="{{ url_for('static',filename='MDB/js/bootstrap.min.js')}}"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="{{ url_for('static',filename='MDB/js/mdb.min.js')}}"></script>
  <!-- Your custom scripts (optional) -->
  <script type="text/javascript"></script>
  <script>
        var buttonclicked = false;
    $("#likebtn").click(function(){
    if( buttonclicked!= true) {
        buttonclicked= true;
        if (post.post_like == "NULL")
            post.post_likes = 0;
        post.post_likes = post.post_likes + 1;
        alert("Button is clicked for first time");
    }else{
        alert("You can like only once");
    }
    });
  </script>
{% endblock content %}
